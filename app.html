<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InGIR Pro | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--accent-blue), var(--accent-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .app-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .nav-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn.active {
            background: linear-gradient(45deg, var(--accent-blue), var(--accent-purple));
            color: white;
            border-color: transparent;
        }
        
        .nav-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }
        
        .app-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }
        
        .main-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--card-border);
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .status-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid var(--card-border);
        }
        
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-active {
            background: rgba(0, 255, 157, 0.1);
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }
        
        .status-inactive {
            background: rgba(255, 46, 142, 0.1);
            color: var(--accent-pink);
            border: 1px solid var(--accent-pink);
        }
        
        .status-warning {
            background: rgba(255, 204, 0, 0.1);
            color: #ffcc00;
            border: 1px solid #ffcc00;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .tool-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .tool-card:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-blue);
            transform: translateY(-5px);
        }
        
        .tool-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(45deg, var(--accent-blue), var(--accent-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .usage-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 30px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
            background: linear-gradient(45deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subscription-info {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .subscription-info h4 {
            margin-bottom: 10px;
        }
        
        .time-left {
            font-size: 14px;
            color: var(--text-muted);
        }
        
        .expired-warning {
            background: rgba(255, 46, 142, 0.1);
            border: 1px solid var(--accent-pink);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }
        
        .btn-renew {
            width: 100%;
            margin-top: 10px;
            padding: 12px;
            background: linear-gradient(45deg, var(--accent-pink), var(--accent-purple));
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-renew:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 46, 142, 0.3);
        }
        
        .logout-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 46, 142, 0.3);
            border-radius: 10px;
            color: var(--accent-pink);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: rgba(255, 46, 142, 0.1);
        }
        
        /* –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ */
        .sync-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: var(--text-muted);
            margin-left: 10px;
            cursor: pointer;
        }
        
        .sync-indicator i {
            font-size: 10px;
        }
        
        .sync-indicator.syncing i {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ */
        .subscription-details {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .subscription-details p {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
        }
        
        .subscription-details .label {
            color: var(--text-secondary);
        }
        
        .subscription-details .value {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .app-content {
                grid-template-columns: 1fr;
            }
            
            .app-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .user-info {
                flex-direction: column;
            }
            
            .tools-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .usage-stats {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .app-nav {
                flex-wrap: wrap;
            }
            
            .nav-btn {
                flex: 1;
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- –§–æ–Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏—Ü—ã -->
    <canvas id="particles-canvas"></canvas>
    <div class="neon-glow"></div>
    <div class="neon-grid"></div>
    
    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="app-container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="app-header">
            <div class="logo">
                <h1>InGIR<span class="gradient-text">Pro</span></h1>
                <p class="tagline">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∏–Ω–∂–∏–Ω–µ—Ä-–∞—Å–∏—Å—Ç–µ–Ω—Ç</p>
            </div>
            
            <div class="nav-auth-container">
                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –º–∏–Ω–∏-–ø—Ä–æ—Ñ–∏–ª—å –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ -->
            </div>
        </header>
        
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="app-nav">
            <button class="nav-btn active" data-panel="dashboard">
                <i class="fas fa-chart-line"></i>
                –î–∞—à–±–æ—Ä–¥
            </button>
            <button class="nav-btn" data-panel="tools">
                <i class="fas fa-tools"></i>
                –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
            </button>
            <button class="nav-btn" data-panel="projects">
                <i class="fas fa-folder-open"></i>
                –ü—Ä–æ–µ–∫—Ç—ã
            </button>
            <button class="nav-btn" data-panel="settings">
                <i class="fas fa-cog"></i>
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
        </nav>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="app-content">
            <!-- –ì–ª–∞–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
            <main class="main-panel">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ -->
                <div id="dashboard-panel" class="panel-content active">
                    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ InGIR Pro!</h2>
                    <p class="lead">–í–∞—à –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
                    
                    <div class="usage-stats">
                        <div class="stat-box">
                            <i class="fas fa-calculator"></i>
                            <div class="stat-value" id="calc-count">0</div>
                            <p>–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Ä–∞—Å—á–µ—Ç–æ–≤</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-file-alt"></i>
                            <div class="stat-value" id="project-count">0</div>
                            <p>–°–æ–∑–¥–∞–Ω–æ –ø—Ä–æ–µ–∫—Ç–æ–≤</p>
                        </div>
                        <div class="stat-box">
                            <i class="fas fa-clock"></i>
                            <div class="stat-value" id="time-saved">0</div>
                            <p>–ß–∞—Å–æ–≤ —Å—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ</p>
                        </div>
                    </div>
                    
                    <h3 class="mt-40">–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</h3>
                    <div class="tools-grid">
                        <div class="tool-card" data-tool="calculator">
                            <div class="tool-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <h4>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h4>
                            <p>–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã</p>
                        </div>
                        <div class="tool-card" data-tool="converter">
                            <div class="tool-icon">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <h4>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä</h4>
                            <p>–ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è</p>
                        </div>
                        <div class="tool-card" data-tool="scheme">
                            <div class="tool-icon">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <h4>–°—Ö–µ–º—ã</h4>
                            <p>–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º</p>
                        </div>
                        <div class="tool-card" data-tool="doc">
                            <div class="tool-icon">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <h4>–î–æ–∫—É–º–µ–Ω—Ç—ã</h4>
                            <p>–®–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
                        </div>
                    </div>
                </div>
                
                <div id="tools-panel" class="panel-content">
                    <h2>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h2>
                    <p>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã</p>
                    <div class="tools-grid">
                        <!-- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
                
                <div id="projects-panel" class="panel-content">
                    <h2>–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</h2>
                    <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã</p>
                    <div id="projects-list">
                        <!-- –ü—Ä–æ–µ–∫—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
                
                <div id="settings-panel" class="panel-content">
                    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                    <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥ —Å–µ–±—è</p>
                    <div class="settings-options">
                        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                    </div>
                </div>
            </main>
            
            <!-- –°–∞–π–¥–±–∞—Ä -->
            <aside class="sidebar">
                <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ -->
                <div class="status-card">
                    <div class="status-header">
                        <h3>–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏</h3>
                        <div>
                            <span class="status-badge" id="status-badge">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            <span class="sync-indicator" id="sync-indicator" title="–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è">
                                <i class="fas fa-sync-alt"></i>
                                <span id="last-sync">‚Äî</span>
                            </span>
                        </div>
                    </div>
                    <div id="subscription-details">
                        <div class="subscription-details" id="subscription-details-content">
                            <p>
                                <span class="label">–¢–∏–ø:</span>
                                <span class="value" id="subscription-type">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            </p>
                            <p>
                                <span class="label">–°—Ç–∞—Ç—É—Å:</span>
                                <span class="value" id="subscription-status">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            </p>
                            <p>
                                <span class="label">–û–±–Ω–æ–≤–ª–µ–Ω–æ:</span>
                                <span class="value" id="subscription-updated">‚Äî</span>
                            </p>
                        </div>
                    </div>
                    <div class="subscription-info">
                        <h4>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:</h4>
                        <p class="time-left" id="subscription-until">‚Äî</p>
                    </div>
                    <div id="expired-warning" class="expired-warning" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞</p>
                        <button class="btn-renew" id="renew-btn">–ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
                    <button class="btn-renew" id="force-sync-btn" style="margin-top: 10px; background: linear-gradient(45deg, var(--accent-blue), var(--accent-purple));">
                        <i class="fas fa-sync-alt"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                    </button>
                </div>
                
                <!-- –ü–æ–º–æ—â—å -->
                <div class="status-card">
                    <h3>–ü–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞</h3>
                    <p>–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –Ω–∞—à—É –ø–æ–¥–¥–µ—Ä–∂–∫—É.</p>
                    <button class="btn-renew" onclick="openSupport()">
                        <i class="fas fa-headset"></i> –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞
                    </button>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
                <button class="logout-btn-profile" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                </button>
            </aside>
        </div>
    </div>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notifications-container"></div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- –ù–∞—à —Å–∫—Ä–∏–ø—Ç -->
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
        const SUPABASE_URL = "https://jacoyuuictmjascjqqpq.supabase.co";
        const SUPABASE_KEY = "sb_publishable_N-2xmPcg8a4NAofPW6dqxA_zfdLSJ9O";
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', async () => {
            console.log("üöÄ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...");
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Supabase
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            const { data: { user } } = await supabase.auth.getUser();
            
            if (!user) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                console.log("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
                window.location.href = "index-Auth.html";
                return;
            }
            
            console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:", user.email);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É
            await checkSubscription(user);
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            setupUI();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserData(user);
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø–æ–¥–ø–∏—Å–∫–∏
            setupSubscriptionSync();
            
            console.log("‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ");
        });
        
        // –ü–†–û–í–ï–†–ö–ê –ü–û–î–ü–ò–°–ö–ò
        async function checkSubscription(user) {
            console.log("üîç –ü—Ä–æ–≤–µ—Ä—è—é –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", user.id);
            
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            try {
                const { data: profile, error } = await supabase
                    .from("profiles")
                    .select("subscription_active, subscription_until, subscription_type, subscription_tier, updated_at")
                    .eq("id", user.id)
                    .single();
                
                if (error) {
                    // –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞
                    console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:", error);
                    showSubscriptionError();
                    return;
                }
                
                console.log("üìã –î–∞–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏:", profile);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏
                updateSubscriptionUI(profile);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                updateSyncTime();
                
            } catch (err) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏:", err);
                showSubscriptionError();
            }
        }
        
        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê –ü–û–î–ü–ò–°–ö–ò
        function updateSubscriptionUI(profile) {
            console.log("üé® –û–±–Ω–æ–≤–ª—è—é UI –ø–æ–¥–ø–∏—Å–∫–∏:", profile);
            
            const isActive = profile.subscription_active;
            const until = profile.subscription_until;
            const subscriptionType = profile.subscription_type || '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è';
            const subscriptionTier = profile.subscription_tier || 'free';
            const updatedAt = profile.updated_at;
            const isExpired = until ? new Date(until) < new Date() : true;
            
            const badge = document.getElementById('status-badge');
            const details = document.getElementById('subscription-details-content');
            const untilElement = document.getElementById('subscription-until');
            const expiredWarning = document.getElementById('expired-warning');
            const subscriptionTypeElement = document.getElementById('subscription-type');
            const subscriptionStatusElement = document.getElementById('subscription-status');
            const subscriptionUpdatedElement = document.getElementById('subscription-updated');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
            if (badge) {
                if (isActive && !isExpired) {
                    // –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞
                    badge.textContent = subscriptionType.toUpperCase();
                    badge.className = "status-badge status-active";
                    
                    if (subscriptionStatusElement) {
                        subscriptionStatusElement.textContent = "–ê–∫—Ç–∏–≤–Ω–∞";
                        subscriptionStatusElement.style.color = "var(--accent-green)";
                    }
                    
                } else if (until && isExpired) {
                    // –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞
                    badge.textContent = "–ò–°–¢–ï–ö–õ–ê";
                    badge.className = "status-badge status-warning";
                    
                    if (subscriptionStatusElement) {
                        subscriptionStatusElement.textContent = "–ò—Å—Ç–µ–∫–ª–∞";
                        subscriptionStatusElement.style.color = "#ffcc00";
                    }
                    
                } else {
                    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞ –∏–ª–∏ –∏—Å—Ç–µ–∫–ª–∞
                    badge.textContent = "–ù–ï–¢ –ü–û–î–ü–ò–°–ö–ò";
                    badge.className = "status-badge status-inactive";
                    
                    if (subscriptionStatusElement) {
                        subscriptionStatusElement.textContent = "–ù–µ –∞–∫—Ç–∏–≤–Ω–∞";
                        subscriptionStatusElement.style.color = "var(--accent-pink)";
                    }
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏
            if (subscriptionTypeElement) {
                subscriptionTypeElement.textContent = subscriptionType;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            if (subscriptionUpdatedElement && updatedAt) {
                const updatedDate = new Date(updatedAt);
                subscriptionUpdatedElement.textContent = updatedDate.toLocaleString('ru-RU');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –∏—Å—Ç–µ—á–µ–Ω–∏—è
            if (untilElement) {
                if (until) {
                    const untilDate = new Date(until);
                    untilElement.textContent = untilDate.toLocaleDateString('ru-RU');
                    
                    if (isActive && !isExpired) {
                        untilElement.style.color = "var(--accent-green)";
                        
                        // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ —Å–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç (–º–µ–Ω–µ–µ 7 –¥–Ω–µ–π)
                        const daysLeft = Math.ceil((untilDate - new Date()) / (1000 * 60 * 60 * 24));
                        if (daysLeft <= 7 && daysLeft > 0) {
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ details
                            if (details) {
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
                                let warningDiv = details.querySelector('.expiring-warning');
                                if (!warningDiv) {
                                    warningDiv = document.createElement('div');
                                    warningDiv.className = 'expiring-warning';
                                    warningDiv.style.cssText = 'margin-top: 10px; padding: 10px; background: rgba(255, 204, 0, 0.1); border: 1px solid #ffcc00; border-radius: 5px;';
                                    warningDiv.innerHTML = `
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <p>–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ ${daysLeft} ${getDayWord(daysLeft)}</p>
                                        <button class="btn-renew" onclick="window.location.href='pay.html'" style="background: linear-gradient(45deg, #ffcc00, #ff9900); margin-top: 5px;">
                                            –ü—Ä–æ–¥–ª–∏—Ç—å —Å–µ–π—á–∞—Å
                                        </button>
                                    `;
                                    details.appendChild(warningDiv);
                                }
                            }
                        } else {
                            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
                            if (details) {
                                const warningDiv = details.querySelector('.expiring-warning');
                                if (warningDiv) {
                                    warningDiv.remove();
                                }
                            }
                        }
                    } else if (isExpired) {
                        untilElement.textContent = `–ò—Å—Ç–µ–∫–ª–∞ ${untilDate.toLocaleDateString('ru-RU')}`;
                        untilElement.style.color = "#ffcc00";
                    }
                } else {
                    untilElement.textContent = "‚Äî";
                    untilElement.style.color = "var(--text-muted)";
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏
            if (expiredWarning) {
                if ((!isActive || isExpired) && !(until && !isExpired)) {
                    expiredWarning.style.display = 'block';
                } else {
                    expiredWarning.style.display = 'none';
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏–Ω–∏-–ø—Ä–æ—Ñ–∏–ª—å –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ UserProfile
            updateMiniProfileSubscription(isActive && !isExpired, subscriptionType);
        }
        
        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ú–ò–ù–ò-–ü–†–û–§–ò–õ–Ø –í –ù–ê–í–ò–ì–ê–¶–ò–ò
        function updateMiniProfileSubscription(isActive, subscriptionType) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–µ–∑ UserProfile –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
            if (window.UserProfile && window.UserProfile.updateUserData) {
                const currentData = window.UserProfile.getUserData();
                if (currentData) {
                    window.UserProfile.updateUserData({
                        subscription: {
                            ...currentData.subscription,
                            active: isActive,
                            type: subscriptionType,
                            isExpired: !isActive
                        }
                    });
                }
            }
            
            // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–ø—Ä—è–º—É—é –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –µ—Å—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.querySelector('.user-subscription span');
            
            if (statusDot && statusText) {
                if (isActive) {
                    statusDot.className = 'status-dot status-active';
                    statusText.textContent = subscriptionType;
                    statusText.style.color = 'var(--accent-green)';
                } else {
                    statusDot.className = 'status-dot status-inactive';
                    statusText.textContent = '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞';
                    statusText.style.color = 'var(--accent-pink)';
                }
            }
        }
        
        // –ü–û–ö–ê–ó–ê–¢–¨ –û–®–ò–ë–ö–£ –ü–û–î–ü–ò–°–ö–ò
        function showSubscriptionError() {
            const badge = document.getElementById('status-badge');
            const details = document.getElementById('subscription-details-content');
            
            if (badge) {
                badge.textContent = "–û–®–ò–ë–ö–ê";
                badge.className = "status-badge status-inactive";
            }
            
            if (details) {
                details.innerHTML = `
                    <p>
                        <span class="label">–°—Ç–∞—Ç—É—Å:</span>
                        <span class="value" style="color: var(--accent-pink);">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</span>
                    </p>
                    <p>
                        <span class="label">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</span>
                        <span class="value">–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–¥–ø–∏—Å–∫–µ</span>
                    </p>
                `;
            }
        }
        
        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –í–†–ï–ú–ï–ù–ò –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò
        function updateSyncTime() {
            const now = new Date();
            const syncTimeElement = document.getElementById('last-sync');
            const syncIndicator = document.getElementById('sync-indicator');
            
            if (syncTimeElement) {
                syncTimeElement.textContent = now.toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            }
            
            // –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            if (syncIndicator) {
                syncIndicator.classList.remove('syncing');
                // –û–±–Ω–æ–≤–ª—è–µ–º title
                syncIndicator.title = `–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: ${now.toLocaleString('ru-RU')}`;
            }
        }
        
        // –ù–ê–°–¢–†–û–ô–ö–ê –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –ü–û–î–ü–ò–°–ö–ò
        function setupSubscriptionSync() {
            const forceSyncBtn = document.getElementById('force-sync-btn');
            const syncIndicator = document.getElementById('sync-indicator');
            
            if (!forceSyncBtn || !syncIndicator) {
                console.warn("‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");
                return;
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            forceSyncBtn.addEventListener('click', async () => {
                console.log("üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏...");
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                syncIndicator.classList.add('syncing');
                forceSyncBtn.disabled = true;
                forceSyncBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
                
                try {
                    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    const { data: { user } } = await supabase.auth.getUser();
                    
                    if (user) {
                        await checkSubscription(user);
                        showNotification('–ü–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', 'success');
                    }
                } catch (error) {
                    console.error("‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:", error);
                    showNotification('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏', 'error');
                } finally {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                    setTimeout(() => {
                        syncIndicator.classList.remove('syncing');
                        forceSyncBtn.disabled = false;
                        forceSyncBtn.innerHTML = '<i class="fas fa-sync-alt"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É';
                    }, 1000);
                }
            });
            
            // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
            window.addEventListener('subscriptionChanged', (event) => {
                console.log("üì¢ –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏:", event.detail);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è
                const subscription = event.detail.subscription;
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                const profileData = {
                    subscription_active: subscription.active,
                    subscription_until: subscription.until,
                    subscription_type: subscription.type || '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è',
                    subscription_tier: subscription.tier || 'free',
                    updated_at: event.detail.timestamp || new Date().toISOString()
                };
                
                updateSubscriptionUI(profileData);
                updateSyncTime();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification(`–ü–æ–¥–ø–∏—Å–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ${subscription.type}`, 'success');
            });
            
            // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
            window.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'SUBSCRIPTION_SYNC_UPDATE') {
                    console.log("üîÑ –ü–æ–ª—É—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑ –¥—Ä—É–≥–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞:", event.data);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UserProfile
                    if (window.UserProfile && window.UserProfile.updateUserData) {
                        window.UserProfile.updateUserData({
                            subscription: event.data.subscription
                        });
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    const profileData = {
                        subscription_active: event.data.subscription.active,
                        subscription_until: event.data.subscription.until,
                        subscription_type: event.data.subscription.type || '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è',
                        subscription_tier: event.data.subscription.tier || 'free',
                        updated_at: new Date().toISOString()
                    };
                    
                    updateSubscriptionUI(profileData);
                    updateSyncTime();
                }
            });
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
            setInterval(async () => {
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                const { data: { user } } = await supabase.auth.getUser();
                
                if (user) {
                    console.log("üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏...");
                    await checkSubscription(user);
                }
            }, 5 * 60 * 1000); // 5 –º–∏–Ω—É—Ç
        }
        
        // –ù–ê–°–¢–†–û–ô–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê
        function setupUI() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø–∞–Ω–µ–ª—è–º
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const panel = btn.getAttribute('data-panel');
                    
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ
                    btn.classList.add('active');
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–∞–Ω–µ–ª–∏
                    document.querySelectorAll('.panel-content').forEach(p => p.classList.remove('active'));
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å
                    document.getElementById(`${panel}-panel`).classList.add('active');
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º
            document.querySelectorAll('.tool-card').forEach(card => {
                card.addEventListener('click', () => {
                    const tool = card.getAttribute('data-tool');
                    openTool(tool);
                });
            });
        }
        
        // –ù–ê–°–¢–†–û–ô–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    await supabase.auth.signOut();
                    window.location.href = "index-Auth.html";
                });
            }
            
            // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
            const renewBtn = document.getElementById('renew-btn');
            if (renewBtn) {
                renewBtn.addEventListener('click', () => {
                    window.location.href = "pay.html";
                });
            }
            
            // –ö–Ω–æ–ø–∫–∞ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏
            window.openSupport = function() {
                window.open('mailto:support@ingirpro.com', '_blank');
            };
        }
        
        // –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        async function loadUserData(user) {
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const { data: stats, error } = await supabase
                    .from("user_stats")
                    .select("*")
                    .eq("user_id", user.id)
                    .single();
                
                if (!error && stats) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
                    const calcCount = document.getElementById('calc-count');
                    const projectCount = document.getElementById('project-count');
                    const timeSaved = document.getElementById('time-saved');
                    
                    if (calcCount) calcCount.textContent = stats.calculations || 0;
                    if (projectCount) projectCount.textContent = stats.projects || 0;
                    if (timeSaved) timeSaved.textContent = stats.hours_saved || 0;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const { data: projects } = await supabase
                    .from("projects")
                    .select("*")
                    .eq("user_id", user.id)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                if (projects && projects.length > 0) {
                    const projectsList = document.getElementById('projects-list');
                    if (projectsList) {
                        projectsList.innerHTML = '';
                        
                        projects.forEach(project => {
                            const projectCard = document.createElement('div');
                            projectCard.className = 'tool-card';
                            projectCard.innerHTML = `
                                <h4>${project.name}</h4>
                                <p>–°–æ–∑–¥–∞–Ω: ${new Date(project.created_at).toLocaleDateString('ru-RU')}</p>
                                <p>–°—Ç–∞—Ç—É—Å: ${project.status || '–í —Ä–∞–±–æ—Ç–µ'}</p>
                            `;
                            projectsList.appendChild(projectCard);
                        });
                    }
                }
                
            } catch (err) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", err);
            }
        }
        
        // –û–¢–ö–†–´–¢–ò–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–ê
        function openTool(toolName) {
            console.log(`–û—Ç–∫—Ä—ã–≤–∞—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: ${toolName}`);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification(`–û—Ç–∫—Ä—ã–≤–∞—é ${getToolName(toolName)}...`, 'success');
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
            const toolsBtn = document.querySelector('[data-panel="tools"]');
            if (toolsBtn) {
                toolsBtn.click();
            }
        }
        
        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–ö–ê–ó–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
        function showNotification(message, type = 'info') {
            const container = document.querySelector('.notifications-container');
            if (!container) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            notification.innerHTML = `
                <div class="notification-header">
                    <div class="notification-title">
                        <i class="fas fa-${icon}"></i>
                        <span>${type === 'success' ? '–£—Å–ø–µ—à–Ω–æ' : type === 'error' ? '–û—à–∏–±–∫–∞' : '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'}</span>
                    </div>
                    <button class="notification-close">&times;</button>
                </div>
                <div class="notification-message">
                    ${message}
                </div>
            `;
            
            container.appendChild(notification);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.5s ease-out forwards';
                setTimeout(() => notification.remove(), 500);
            }, 5000);
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.style.animation = 'slideOut 0.5s ease-out forwards';
                setTimeout(() => notification.remove(), 500);
            });
        }
        
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function getToolName(toolId) {
            const tools = {
                'calculator': '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä',
                'converter': '–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –µ–¥–∏–Ω–∏—Ü',
                'scheme': '–†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ö–µ–º',
                'doc': '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤'
            };
            return tools[toolId] || '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç';
        }
        
        function getDayWord(days) {
            if (days === 1) return '–¥–µ–Ω—å';
            if (days >= 2 && days <= 4) return '–¥–Ω—è';
            return '–¥–Ω–µ–π';
        }
        
        // –ü–ê–†–¢–ò–ö–õ–ò (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function initParticles() {
            const canvas = document.getElementById('particles-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let particles = [];
            
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                createParticles();
            }
            
            function createParticles() {
                particles = [];
                const count = Math.floor((canvas.width * canvas.height) / 20000);
                
                for (let i = 0; i < count; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        size: Math.random() * 2 + 0.5,
                        speedX: Math.random() * 0.3 - 0.15,
                        speedY: Math.random() * 0.3 - 0.15
                    });
                }
            }
            
            function animate() {
                requestAnimationFrame(animate);
                ctx.fillStyle = 'rgba(10, 10, 20, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach(p => {
                    p.x += p.speedX;
                    p.y += p.speedY;
                    
                    if (p.x < 0 || p.x > canvas.width) p.speedX *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.speedY *= -1;
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(0, 212, 255, 0.5)';
                    ctx.fill();
                });
            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            animate();
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(initParticles, 1000);
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
    <script src="profile-module.js"></script>
    <script src="subscription-sync.js"></script>
    <script src="logout-handler.js"></script>
</body>
</html>